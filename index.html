<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>腦力體能訓練動畫生成器</title>
    <!-- React 和 ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 確保頁面填滿整個視窗 */
        html, body, #root {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        function TrainerApp() {
            // 基本狀態
            const [isPlaying, setIsPlaying] = React.useState(false);
            const [currentItem, setCurrentItem] = React.useState(null);
            const [displayCount, setDisplayCount] = React.useState(0);
            
            // 時間設定
            const [displayTime, setDisplayTime] = React.useState(1000);
            const [pauseTime, setPauseTime] = React.useState(500);
            
            // 節拍器設定
            const [useMetronome, setUseMetronome] = React.useState(false);
            const [bpm, setBpm] = React.useState(120);
            
            // 內容設定
            const [showArrows, setShowArrows] = React.useState(true);
            const [showColors, setShowColors] = React.useState(true);
            const [showNumbers, setShowNumbers] = React.useState(true);
            const [showShapes, setShowShapes] = React.useState(true);
            const [showCustomText, setShowCustomText] = React.useState(false);
            
            // 顯示文字說明
            const [showText, setShowText] = React.useState(false);
            
            // 自定義文字
            const [customTexts, setCustomTexts] = React.useState(['加油', '專注', '放鬆', '呼吸']);
            const [newCustomText, setNewCustomText] = React.useState('');
            
            // 計時器參考
            const timerRef = React.useRef(null);
            const pauseTimerRef = React.useRef(null);
            const metronomeRef = React.useRef(null);
            const startTimeRef = React.useRef(null);
            
            // 內容定義
            const items = {
                arrows: ['上', '下', '左', '右'],
                colors: ['紅', '藍', '綠', '黃', '黑'],
                numbers: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],
                shapes: ['圓形', '三角形', '正方形', '五邊形']
            };
            
            // 選項選擇狀態
            const [selectedItems, setSelectedItems] = React.useState({
                arrows: { '上': true, '下': true, '左': true, '右': true },
                colors: { '紅': true, '藍': true, '綠': true, '黃': true, '黑': true },
                numbers: { '0': true, '1': true, '2': true, '3': true, '4': true, '5': true, '6': true, '7': true, '8': true, '9': true },
                shapes: { '圓形': true, '三角形': true, '正方形': true, '五邊形': true }
            });
            
            // 停止所有計時器
            const stopAllTimers = () => {
                clearTimeout(timerRef.current);
                clearTimeout(pauseTimerRef.current);
                clearInterval(metronomeRef.current);
            };
            
            // 啟動節拍器
            const startMetronome = () => {
                if (!useMetronome) return;
                
                clearInterval(metronomeRef.current);
                
                const interval = 60000 / bpm;
                try {
                    metronomeRef.current = setInterval(() => {
                        try {
                            const context = new (window.AudioContext || window.webkitAudioContext)();
                            const osc = context.createOscillator();
                            const gain = context.createGain();
                            osc.connect(gain);
                            gain.connect(context.destination);
                            osc.frequency.value = 800;
                            osc.start();
                            setTimeout(() => osc.stop(), 50);
                        } catch (e) {
                            console.log('播放節拍器音效失敗:', e);
                        }
                    }, interval);
                } catch (e) {
                    console.log('啟動節拍器失敗:', e);
                }
            };
            
            // 生成隨機項目
            const getRandomItem = () => {
                const availableTypes = [];
                if (showArrows) availableTypes.push('arrows');
                if (showColors) availableTypes.push('colors');
                if (showNumbers) availableTypes.push('numbers');
                if (showShapes) availableTypes.push('shapes');
                if (showCustomText && customTexts.length > 0) availableTypes.push('customText');
                
                if
